<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SURAKSHA KAVACH</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body, html {
  margin:0; padding:0; height:100%;
  font-family: Arial, sans-serif;
}

/* Landing Page */
#landing {
  height:100vh;
  background:#2f3b55;
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}
#landing h1 { font-size:36px; margin:10px; }
#landing p { max-width:600px; font-size:18px; }
#enterBtn {
  padding:15px 30px;
  font-size:18px;
  border:none;
  border-radius:10px;
  background:#f5f5f5;
  cursor:pointer;
}

/* Map */
#map { display:none; height:100vh; }
#sosBtn {
  position:absolute;
  top:10px; left:50%;
  transform:translateX(-50%);
  z-index:1000;
  padding:12px 25px;
  background:black;
  color:white;
  font-size:18px;
  border:none;
  border-radius:8px;
  display:none;
}
</style>
</head>

<body>

<!-- LANDING -->
<div id="landing">
  <h1>SURAKSHA KAVACH</h1>
  <p>
    Women Safety Platform with live location, SOS alerts,
    nearby hospitals & police stations, and emergency contact system.
  </p>
  <button id="enterBtn">Enter Map</button>
</div>

<!-- MAP -->
<div id="map"></div>
<button id="sosBtn">üö® SOS</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map;

/* ---------- helper: random nearby location ---------- */
function randomNearby(lat, lng, km) {
  const r = km / 111;
  const u = Math.random();
  const v = Math.random();
  const w = r * Math.sqrt(u);
  const t = 2 * Math.PI * v;
  return [
    lat + w * Math.cos(t),
    lng + w * Math.sin(t)
  ];
}

/* ---------- LANDING ‚Üí MAP ---------- */
document.getElementById("enterBtn").onclick = () => {
  document.getElementById("landing").style.display = "none";
  document.getElementById("map").style.display = "block";
  document.getElementById("sosBtn").style.display = "block";
  initMap();
};

/* ---------- MAP ---------- */
function initMap() {
  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    map = L.map("map").setView([lat, lng], 14);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap"
    }).addTo(map);

    // You are here
    L.marker([lat, lng])
      .addTo(map)
      .bindPopup("üìç You are here")
      .openPopup();

    // Generate data
    let hospitals = [];
    let policeStations = [];

    for (let i = 0; i < 8; i++)
      hospitals.push(randomNearby(lat, lng, 20));

    for (let i = 0; i < 6; i++)
      policeStations.push(randomNearby(lat, lng, 20));

    // Hospitals (RED)
    hospitals.forEach(loc => {
      L.circle(loc, {
        radius: 1200,
        color: "red",
        fillColor: "red",
        fillOpacity: 0.6
      }).addTo(map).bindPopup("üè• Hospital");
    });

    // Police (BLUE)
    policeStations.forEach(loc => {
      L.circle(loc, {
        radius: 1200,
        color: "blue",
        fillColor: "blue",
        fillOpacity: 0.6
      }).addTo(map).bindPopup("üöì Police Station");
    });

  }, () => alert("Location permission denied"));
}

/* ---------- SOS ---------- */
document.getElementById("sosBtn").onclick = () => {
  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    alert(
      "üö® EMERGENCY ALERT\n\n" +
      "üëÆ Police: 100\n" +
      "üöë Ambulance: 102\n" +
      "üî• Fire: 101\n" +
      "üë© Women: 1091\n" +
      "üßí Child: 1098"
    );

    const numbers = prompt(
      "Enter WhatsApp numbers (comma separated)\nExample:\n+91XXXXXXXXXX,+91YYYYYYYYYY"
    );

    if (numbers) {
      const msg = encodeURIComponent(
        `üö® SOS! I need help.\nMy location:\nhttps://www.google.com/maps?q=${lat},${lng}`
      );
      numbers.split(",").forEach(n => {
        window.open(`https://wa.me/${n.trim()}?text=${msg}`, "_blank");
      });
    }

    L.marker([lat, lng], {
      icon: L.icon({
        iconUrl: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
        iconSize: [32, 32]
      })
    }).addTo(map)
      .bindPopup("üö® SOS SENT")
      .openPopup();

    map.setView([lat, lng], 15);

  });
};
</script>

</body>
</html>